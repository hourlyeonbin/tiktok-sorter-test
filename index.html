<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Yeonbin Sorter</title>

<style>
#mainTable {
    font-size: 19px;
    font-family: 'Times New Roman', serif;
    text-align: center;
    width: 410px;
    margin: auto;
    border-spacing: 10px 5px;
}
#leftField, #rightField {
    width: 150px;
    height: 150px;
    border: 1px solid #000;
    cursor: pointer;
    vertical-align: top;
}
#leftField img, #rightField img {
    max-width: 100%;
    max-height: 100%;
}
.middleField {
    width: 120px;
    height: 70px;
    border: 1px solid #000;
    cursor: pointer;
}
.nameText {
    margin-top: 5px;
    font-weight: normal;
    font-size: 14px;
    display: block;
}
</style>

<script>
var namMember = [
  { img: "tiktok/tiktok01.jpeg", name: "Sigma TikTok" },
  { img: "tiktok/tiktok02.jpeg", name: "Alpha TikTok" },
  { img: "tiktok/tiktok03.jpeg", name: "Beta TikTok" },
  { img: "tiktok/tiktok04.jpeg", name: "Gamma TikTok" },
  { img: "tiktok/tiktok05.jpeg", name: "Delta TikTok" },
  { img: "tiktok/tiktok06.jpeg", name: "Epsilon TikTok" },
  { img: "tiktok/tiktok07.jpeg", name: "Zeta TikTok" },
  { img: "tiktok/tiktok08.jpeg", name: "Eta TikTok" },
  { img: "tiktok/tiktok09.jpeg", name: "Theta TikTok" },
  { img: "tiktok/tiktok10.jpeg", name: "Iota TikTok" },
  { img: "tiktok/tiktok11.jpeg", name: "Kappa TikTok" },
  { img: "tiktok/tiktok12.jpeg", name: "Lambda TikTok" },
  { img: "tiktok/tiktok13.jpeg", name: "Mu TikTok" }
];

var lstMember = [], parent = [], equal = [], rec = [];
var cmp1, cmp2, head1, head2;
var nrec, numQuestion, totalSize, finishSize, finishFlag;

function initList() {
    lstMember = [];
    parent = [];
    equal = [];
    rec = [];

    lstMember[0] = [];
    for (let i = 0; i < namMember.length; i++) lstMember[0][i] = i;
    parent[0] = -1;

    totalSize = 0;
    let n = 1;

    for (let i = 0; i < lstMember.length; i++) {
        if (lstMember[i].length >= 2) {
            let mid = Math.ceil(lstMember[i].length / 2);
            lstMember[n] = lstMember[i].slice(0, mid);
            totalSize += lstMember[n].length;
            parent[n++] = i;

            lstMember[n] = lstMember[i].slice(mid);
            totalSize += lstMember[n].length;
            parent[n++] = i;
        }
    }

    for (let i = 0; i < namMember.length; i++) equal[i] = -1;

    cmp1 = lstMember.length - 2;
    cmp2 = lstMember.length - 1;
    head1 = head2 = 0;
    nrec = 0;
    finishSize = 0;
    numQuestion = 1;
    finishFlag = false;
}

function sortList(flag) {
    if (flag < 0) push(cmp1, head1++);
    else if (flag > 0) push(cmp2, head2++);
    else {
        push(cmp1, head1++);
        equal[rec[nrec - 1]] = lstMember[cmp2][head2];
        push(cmp2, head2++);
    }

    while (head1 < lstMember[cmp1].length && head2 === lstMember[cmp2].length)
        push(cmp1, head1++);
    while (head2 < lstMember[cmp2].length && head1 === lstMember[cmp1].length)
        push(cmp2, head2++);

    if (head1 === lstMember[cmp1].length && head2 === lstMember[cmp2].length) {
        for (let i = 0; i < rec.length; i++)
            lstMember[parent[cmp1]][i] = rec[i];

        lstMember.pop();
        lstMember.pop();
        cmp1 -= 2;
        cmp2 -= 2;
        head1 = head2 = 0;
        rec = [];
        nrec = 0;
    }

    if (cmp1 < 0) {
        document.getElementById("battleNumber").innerHTML =
            "Finished! 100% sorted.";
        showResult();
        finishFlag = true;
    } else showImage();
}

function push(cmp, head) {
    rec[nrec++] = lstMember[cmp][head];
    finishSize++;
}

function showImage() {
    document.getElementById("battleNumber").innerHTML =
        "battle #" + numQuestion++ + "<br>" +
        Math.floor(finishSize * 100 / totalSize) + "% sorted.";

    let left = lstMember[cmp1][head1];
    let right = lstMember[cmp2][head2];

    document.getElementById("leftField").innerHTML =
        `<img src="${namMember[left].img}"><span class="nameText">${namMember[left].name}</span>`;
    document.getElementById("rightField").innerHTML =
        `<img src="${namMember[right].img}"><span class="nameText">${namMember[right].name}</span>`;
}

function showResult() {
    let str = "<h3>Results</h3>";
    lstMember[0].forEach((i, idx) => {
        str += `<p>${idx + 1}. <img src="${namMember[i].img}" style="max-width:50px; vertical-align:middle;"> ${namMember[i].name}</p>`;
    });
    document.getElementById("resultField").innerHTML = str;
}

window.onload = () => {
    initList();
    showImage();
};
</script>
</head>

<body>
<center><h2>YEONBIN TIKTOK SORTER</h2></center>

<table id="mainTable">
<tr>
<td id="battleNumber" colspan="3"></td>
</tr>
<tr>
<td id="leftField" onclick="!finishFlag && sortList(-1)" rowspan="2"></td>
<td class="middleField" onclick="!finishFlag && sortList(0)">I like both</td>
<td id="rightField" onclick="!finishFlag && sortList(1)" rowspan="2"></td>
</tr>
<tr>
<td class="middleField" onclick="!finishFlag && sortList(0)">no opinion</td>
</tr>
</table>

<div id="resultField" style="text-align:center;"></div>
</body>
</html>

