<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Sorter</title>

<style>
#mainTable {
    font-size: 19px;
    font-family: 'Times New Roman', serif;
    text-align: center;
    width: 410px;
    margin: auto;
    border-spacing: 10px 5px;
}
#leftField, #rightField {
    width: 150px;
    height: 150px;
    border: 1px solid #000;
    cursor: pointer;
}
#leftField img, #rightField img {
    max-width: 100%;
    max-height: 100%;
}
.middleField {
    width: 120px;
    height: 70px;
    border: 1px solid #000;
    cursor: pointer;
}

body {
    max-width: 600px;
    margin: auto;
}

/* MOBILE-FRIENDLY */
@media (max-width: 768px) {

  body {
    width: 95%;
    margin: 0 auto;
  }

  #mainTable {
    width: 100%;
    font-size: 16px;
    border-spacing: 6px 4px;
    display: block;
  }

  #battleNumber {
    font-size: 18px;
    margin-bottom: 10px;
    display: block;
  }

  #leftField, #rightField {
    width: 90%;
    height: auto;
    display: block;
    margin: 10px auto;
  }

  #leftField img, #rightField img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  .middleField {
    width: 90%;
    height: 50px;
    display: block;
    margin: 8px auto;
    font-size: 16px;
    padding: 10px 0;
  }
}
</style>

<script>
var namMember = [
  '<img src="tiktok/tiktok01.jpeg">',
  '<img src="tiktok/tiktok02.jpeg">',
  '<img src="tiktok/tiktok03.jpeg">',
  '<img src="tiktok/tiktok04.jpeg">',
  '<img src="tiktok/tiktok05.jpeg">',
  '<img src="tiktok/tiktok06.jpeg">',
  '<img src="tiktok/tiktok07.jpeg">',
  '<img src="tiktok/tiktok08.jpeg">',
  '<img src="tiktok/tiktok09.jpeg">',
  '<img src="tiktok/tiktok10.jpeg">',
  '<img src="tiktok/tiktok11.jpeg">',
  '<img src="tiktok/tiktok12.jpeg">',
  '<img src="tiktok/tiktok13.jpeg">'
];

var lstMember = [], parent = [], equal = [], rec = [];
var cmp1, cmp2, head1, head2;
var nrec, numQuestion, totalSize, finishSize, finishFlag;

function initList() {
    lstMember = [];
    parent = [];
    equal = [];
    rec = [];

    lstMember[0] = [];
    for (let i = 0; i < namMember.length; i++) lstMember[0][i] = i;
    parent[0] = -1;

    totalSize = 0;
    let n = 1;

    for (let i = 0; i < lstMember.length; i++) {
        if (lstMember[i].length >= 2) {
            let mid = Math.ceil(lstMember[i].length / 2);
            lstMember[n] = lstMember[i].slice(0, mid);
            totalSize += lstMember[n].length;
            parent[n++] = i;

            lstMember[n] = lstMember[i].slice(mid);
            totalSize += lstMember[n].length;
            parent[n++] = i;
        }
    }

    for (let i = 0; i < namMember.length; i++) equal[i] = -1;

    cmp1 = lstMember.length - 2;
    cmp2 = lstMember.length - 1;
    head1 = head2 = 0;
    nrec = 0;
    finishSize = 0;
    numQuestion = 1;
    finishFlag = false;
}

function sortList(flag) {
    if (flag < 0) push(cmp1, head1++);
    else if (flag > 0) push(cmp2, head2++);
    else {
        push(cmp1, head1++);
        equal[rec[nrec - 1]] = lstMember[cmp2][head2];
        push(cmp2, head2++);
    }

    while (head1 < lstMember[cmp1].length && head2 === lstMember[cmp2].length)
        push(cmp1, head1++);
    while (head2 < lstMember[cmp2].length && head1 === lstMember[cmp1].length)
        push(cmp2, head2++);

    if (head1 === lstMember[cmp1].length && head2 === lstMember[cmp2].length) {
        for (let i = 0; i < rec.length; i++)
            lstMember[parent[cmp1]][i] = rec[i];

        lstMember.pop();
        lstMember.pop();
        cmp1 -= 2;
        cmp2 -= 2;
        head1 = head2 = 0;
        rec = [];
        nrec = 0;
    }

    if (cmp1 < 0) {
        document.getElementById("battleNumber").innerHTML =
            "Finished! 100% sorted.";
        showResult();
        finishFlag = true;
    } else showImage();
}

function push(cmp, head) {
    rec[nrec++] = lstMember[cmp][head];
    finishSize++;
}

function showImage() {
    document.getElementById("battleNumber").innerHTML =
        "battle #" + numQuestion++ + "<br>" +
        Math.floor(finishSize * 100 / totalSize) + "% sorted.";

    document.getElementById("leftField").innerHTML =
        namMember[lstMember[cmp1][head1]];
    document.getElementById("rightField").innerHTML =
        namMember[lstMember[cmp2][head2]];
}

function showResult() {
    let str = "<h3>Results</h3>";
    lstMember[0].forEach((i, idx) => {
        str += `<p>${idx + 1}. ${namMember[i]}</p>`;
    });
    document.getElementById("resultField").innerHTML = str;
}

window.onload = () => {
    initList();
    showImage();
};
</script>
</head>

<body>
<center><h2>SORTER NAME</h2></center>

<table id="mainTable">
<tr>
<td id="battleNumber" colspan="3"></td>
</tr>
<tr>
<td id="leftField" onclick="!finishFlag && sortList(-1)" rowspan="2"></td>
<td class="middleField" onclick="!finishFlag && sortList(0)">I like both</td>
<td id="rightField" onclick="!finishFlag && sortList(1)" rowspan="2"></td>
</tr>
<tr>
<td class="middleField" onclick="!finishFlag && sortList(0)">no opinion</td>
</tr>
</table>

<div id="resultField" style="text-align:center;"></div>
</body>
</html>



