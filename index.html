<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>Image Sorter</title>

<style type="text/css">
#mainTable {
    font-size: 19px;
    font-family: 'Times New Roman', serif;
    text-align: center;
    vertical-align: middle;
    width: 410px;
    margin-left: auto;
    margin-right: auto;
    border-collapse: separate;
    border-spacing: 10px 5px;
}
#leftField, #rightField {
    width: 150px;
    height: 150px;
    text-align: center;
    vertical-align: middle;
    border: 1px solid #000;
    cursor: pointer;
}
#leftField img, #rightField img {
    max-width: 100%;
    max-height: 100%;
}
.middleField {
    width: 120px;
    height: 70px;
    border: 1px solid #000;
    cursor: pointer;
}
body {
    width: 600px;
    margin: 0 auto;
    font-family: 'Times New Roman', serif;
}
a {
    color: #e097d9;
    text-decoration: none;
}
a:hover {
    color: #8f8f8f;
}
</style>

<script type="text/javascript">
window.onload = function() {

    // Just the filenames
    var namMember = [
        "tiktok/tiktok01.jpeg",
        "tiktok/tiktok02.jpeg",
        "tiktok/tiktok03.jpeg",
        "tiktok/tiktok04.jpeg",
        "tiktok/tiktok05.jpeg",
        "tiktok/tiktok06.jpeg",
        "tiktok/tiktok07.jpeg",
        "tiktok/tiktok08.jpeg",
        "tiktok/tiktok09.jpeg",
        "tiktok/tiktok10.jpeg",
        "tiktok/tiktok11.jpeg",
        "tiktok/tiktok12.jpeg",
        "tiktok/tiktok13.jpeg"
    ];

    var lstMember = [namMember.map((_, i) => i)]; // start with indices
    var rec = [];
    var equal = [];
    var cmp1, cmp2;
    var head1, head2;
    var nrec;
    var numQuestion;
    var totalSize;
    var finishSize;
    var finishFlag;

    function initList() {
        // Build merge-sort style tree
        var n = 0;
        var parent = [-1];
        totalSize = 0;

        while (n < lstMember.length) {
            if (lstMember[n].length >= 2) {
                var mid = Math.ceil(lstMember[n].length / 2);
                lstMember.push(lstMember[n].slice(0, mid));
                lstMember.push(lstMember[n].slice(mid));
                totalSize += lstMember[n].length;
            }
            n++;
        }

        rec = [];
        nrec = 0;
        equal = Array(namMember.length).fill(-1);

        cmp1 = lstMember.length - 2;
        cmp2 = lstMember.length - 1;
        head1 = 0;
        head2 = 0;
        numQuestion = 1;
        finishSize = 0;
        finishFlag = 0;
    }

    function sortList(flag) {
        var currentList1 = lstMember[cmp1];
        var currentList2 = lstMember[cmp2];

        if (flag <= 0) { // choose left or tie
            rec.push(currentList1[head1++]);
            finishSize++;
        }
        if (flag >= 0) { // choose right or tie
            rec.push(currentList2[head2++]);
            finishSize++;
        }

        if (head1 == currentList1.length && head2 == currentList2.length) {
            lstMember[Math.floor(cmp1/2)] = rec.slice();
            lstMember.pop();
            lstMember.pop();
            cmp1 -= 2;
            cmp2 -= 2;
            head1 = 0;
            head2 = 0;
            rec = [];
        }

        if (cmp1 < 0) {
            showResult();
            finishFlag = 1;
        } else {
            showImage();
        }
    }

    function showImage() {
        document.getElementById("battleNumber").innerHTML =
            "battle #" + numQuestion + "<br>" + Math.floor(finishSize * 100 / totalSize) + "% sorted.";

        var leftIndex = lstMember[cmp1][head1];
        var rightIndex = lstMember[cmp2][head2];

        document.getElementById("leftField").innerHTML = '<img src="' + namMember[leftIndex] + '">';
        document.getElementById("rightField").innerHTML = '<img src="' + namMember[rightIndex] + '">';

        numQuestion++;
    }

    function showResult() {
        var str = '<table style="width:200px; font-size:18px; margin:auto; border:1px solid #000; border-collapse:collapse">';
        str += '<tr><td style="background:#e097d9; color:white;">rank</td><td style="background:#e097d9; color:white;">image</td></tr>';
        for (var i = 0; i < namMember.length; i++) {
            str += '<tr><td style="border:1px solid #000;">' + (i+1) + '</td>';
            str += '<td style="border:1px solid #000;"><img src="' + namMember[lstMember[0][i]] + '"></td></tr>';
        }
        str += '</table>';
        document.getElementById("resultField").innerHTML = str;
    }

    initList();
    showImage();

    window.sortList = sortList; // make clickable functions accessible
};
</script>

</head>

<body>

<center><br><br>
<b>SORTER NAME</b><br><br>
Pick the image you like better in each battle.<br>
</center>

<table id="mainTable" align="center">
<tr>
<td id="battleNumber" colspan="3"><b>battle #1<br>0% sorted.</b></td>
</tr>
<tr>
<td id="leftField" onclick="if(!finishFlag) sortList(-1);" rowspan="2"></td>
<td class="middleField" onclick="if(!finishFlag) sortList(0);">I like both</td>
<td id="rightField" onclick="if(!finishFlag) sortList(1);" rowspan="2"></td>
</tr>
<tr>
<td class="middleField" onclick="if(!finishFlag) sortList(0);">no opinion</td>
</tr>
</table>

<br><br>
<div id="resultField" style="text-align:center;"></div>

</body>
</html>
